<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self'; script-src 'self';">
  <title>OneClaw</title>
  <link rel="stylesheet" href="settings.css">
</head>
<body>

  <div class="toast-container" id="toastContainer"></div>

  <div class="settings-layout">

    <!-- 左侧导航 -->
    <nav class="sidebar">
      <div class="sidebar-title" data-i18n="title">Settings</div>
      <ul class="nav-list">
        <li class="nav-item active" data-tab="provider">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M8 1L2 4.5V11.5L8 15L14 11.5V4.5L8 1Z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/>
            <circle cx="8" cy="8" r="2" stroke="currentColor" stroke-width="1.3"/>
          </svg>
          <span data-i18n="nav.provider">Model</span>
        </li>
        <li class="nav-item" data-tab="channels">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M2 4H14M2 8H10M2 12H12" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
          </svg>
          <span data-i18n="nav.feishu">Feishu Integration</span>
        </li>
        <li class="nav-item" data-tab="kimi">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M5 3V13M5 8L11 3M5 8L11 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span data-i18n="nav.kimi">KimiClaw</span>
        </li>
        <li class="nav-item" data-tab="doctor">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M8 2V14M2 8H14" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
            <rect x="1" y="1" width="14" height="14" rx="3" stroke="currentColor" stroke-width="1.3"/>
          </svg>
          <span data-i18n="nav.doctor">Doctor</span>
        </li>
        <li class="nav-item" data-tab="appearance">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <circle cx="8" cy="8" r="5.5" stroke="currentColor" stroke-width="1.3"/>
            <path d="M8 2.5V13.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
          </svg>
          <span data-i18n="nav.appearance">外观</span>
        </li>
        <li class="nav-item" data-tab="advanced">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M2 5H14M2 8H14M2 11H14" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
            <circle cx="5" cy="5" r="1.2" fill="currentColor"/>
            <circle cx="11" cy="8" r="1.2" fill="currentColor"/>
            <circle cx="7" cy="11" r="1.2" fill="currentColor"/>
          </svg>
          <span data-i18n="nav.advanced">Advanced</span>
        </li>
      </ul>
    </nav>

    <!-- 右侧内容区 -->
    <main class="content">

      <!-- Provider Tab -->
      <section class="tab-panel active" id="tabProvider">
        <h2 data-i18n="provider.title">Model Configuration</h2>
        <p class="desc" data-i18n="provider.desc">Change your LLM provider, API key, or model.</p>

        <!-- 当前 provider 状态指示 -->
        <div class="current-provider-status hidden" id="currentProviderStatus"></div>

        <!-- Provider 分段选择器 -->
        <div class="provider-tabs" id="providerTabs">
          <button class="provider-tab active" data-provider="anthropic">Anthropic</button>
          <button class="provider-tab" data-provider="moonshot">Moonshot</button>
          <button class="provider-tab" data-provider="openai">OpenAI</button>
          <button class="provider-tab" data-provider="google">Google</button>
          <button class="provider-tab" data-provider="custom" data-i18n="provider.custom">Custom</button>
        </div>

        <!-- Moonshot 子平台 -->
        <div class="field-group hidden" id="subPlatformGroup">
          <label data-i18n="provider.platform">Platform</label>
          <div class="radio-group">
            <label class="radio-item">
              <input type="radio" name="subPlatform" value="moonshot-cn" checked>
              <span>Moonshot CN</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="subPlatform" value="moonshot-ai">
              <span>Moonshot AI</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="subPlatform" value="kimi-code">
              <span>Kimi Code</span>
            </label>
          </div>
        </div>

        <!-- Custom: Base URL -->
        <div class="field-group hidden" id="baseURLGroup">
          <label for="baseURL" data-i18n="provider.baseUrl">Base URL</label>
          <input type="url" id="baseURL" placeholder="https://api.example.com/v1" autocomplete="off">
        </div>

        <!-- API Key -->
        <div class="field-group">
          <div class="label-row">
            <label for="apiKey" data-i18n="provider.apiKey">API Key</label>
            <a href="#" class="platform-link" id="platformLink">Get API Key →</a>
          </div>
          <div class="input-password-wrap">
            <input type="password" id="apiKey" placeholder="sk-ant-..." autocomplete="off" spellcheck="false">
            <button class="btn-toggle-vis" id="btnToggleKey" type="button" title="Toggle visibility">
              <svg class="icon-eye" width="18" height="18" viewBox="0 0 18 18" fill="none">
                <path d="M1.5 9C1.5 9 4 3.75 9 3.75C14 3.75 16.5 9 16.5 9C16.5 9 14 14.25 9 14.25C4 14.25 1.5 9 1.5 9Z" stroke="currentColor" stroke-width="1.3"/>
                <circle cx="9" cy="9" r="2.25" stroke="currentColor" stroke-width="1.3"/>
              </svg>
              <svg class="icon-eye-off hidden" width="18" height="18" viewBox="0 0 18 18" fill="none">
                <path d="M2.5 2.5L15.5 15.5M7.05 7.05A2.25 2.25 0 0010.95 10.95M1.5 9C1.5 9 4 3.75 9 3.75C10.2 3.75 11.3 4.1 12.25 4.6M16.5 9C16.5 9 14 14.25 9 14.25C7.8 14.25 6.7 13.9 5.75 13.4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- 模型选择（非 Custom） -->
        <div class="field-group" id="modelSelectGroup">
          <label for="modelSelect" data-i18n="provider.model">Model</label>
          <select id="modelSelect"></select>
        </div>

        <!-- Custom: Model ID -->
        <div class="field-group hidden" id="modelInputGroup">
          <label for="modelInput" data-i18n="provider.modelId">Model ID</label>
          <input type="text" id="modelInput" placeholder="e.g. my-custom-model" autocomplete="off">
        </div>

        <!-- Custom: API Type -->
        <div class="field-group hidden" id="apiTypeGroup">
          <label data-i18n="provider.apiType">API Type</label>
          <div class="radio-group">
            <label class="radio-item">
              <input type="radio" name="apiType" value="openai-completions" checked>
              <span>OpenAI Completions</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="apiType" value="anthropic-messages">
              <span>Anthropic Messages</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="apiType" value="openai-responses">
              <span>OpenAI Responses</span>
            </label>
          </div>
        </div>

        <!-- Custom: 图像支持 -->
        <div class="field-group hidden" id="imageSupportGroup">
          <label class="checkbox-item">
            <input type="checkbox" id="supportImage" checked>
            <span data-i18n="provider.supportImage">Supports image input</span>
          </label>
        </div>

        <!-- 错误 / 成功信息 -->
        <div class="msg-box hidden" id="msgBox"></div>

        <!-- 操作按钮 -->
        <div class="btn-row bottom-actions">
          <button class="btn-primary" id="btnSave">
            <span class="btn-text" data-i18n="provider.save">Save</span>
            <span class="btn-spinner hidden"></span>
          </button>
        </div>
      </section>

      <!-- Channels Tab -->
      <section class="tab-panel" id="tabChannels">
        <h2 data-i18n="feishu.title">Feishu Integration</h2>

        <div id="channelFeishu" class="channel-panel">
          <div class="channel-desc-row">
            <p class="desc" data-i18n="feishu.desc">Connect Feishu to chat with AI directly in your group.</p>
            <a href="#" class="platform-link" id="chConsoleLink" data-i18n="feishu.getKey">Open Feishu Console →</a>
          </div>

          <!-- 启用/禁用开关 -->
          <div class="toggle-row">
            <span class="toggle-label" data-i18n="feishu.enabled">Enable</span>
            <label class="toggle-switch">
              <input type="checkbox" id="chEnabled">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- 配置字段（禁用时隐藏） -->
          <div id="chFields" class="hidden">
            <!-- App ID -->
            <div class="field-group">
              <label for="chAppId" data-i18n="feishu.appId">Feishu App ID</label>
              <input type="text" id="chAppId" placeholder="cli_xxxxxxxx" autocomplete="off" spellcheck="false">
            </div>

            <!-- App Secret -->
            <div class="field-group">
              <label for="chAppSecret" data-i18n="feishu.appSecret">App Secret</label>
              <div class="input-password-wrap">
                <input type="password" id="chAppSecret" placeholder="••••••••" autocomplete="off" spellcheck="false">
                <button class="btn-toggle-vis" id="btnToggleChSecret" type="button" title="Toggle visibility">
                  <svg class="icon-eye" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M1.5 9C1.5 9 4 3.75 9 3.75C14 3.75 16.5 9 16.5 9C16.5 9 14 14.25 9 14.25C4 14.25 1.5 9 1.5 9Z" stroke="currentColor" stroke-width="1.3"/>
                    <circle cx="9" cy="9" r="2.25" stroke="currentColor" stroke-width="1.3"/>
                  </svg>
                  <svg class="icon-eye-off hidden" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M2.5 2.5L15.5 15.5M7.05 7.05A2.25 2.25 0 0010.95 10.95M1.5 9C1.5 9 4 3.75 9 3.75C10.2 3.75 11.3 4.1 12.25 4.6M16.5 9C16.5 9 14 14.25 9 14.25C7.8 14.25 6.7 13.9 5.75 13.4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>
            </div>

            <div class="field-group">
              <label class="checkbox-item">
                <input type="checkbox" id="chDmPolicyOpen">
                <span data-i18n="feishu.dmPolicyOpen">Open authorization (no pairing required)</span>
              </label>
              <p class="field-hint" data-i18n="feishu.dmPolicyHint">When enabled, all DM users can start chatting directly.</p>
            </div>

            <div class="pairing-panel">
              <div class="pairing-header">
                <span class="pairing-title" data-i18n="feishu.pairingTitle">Pending Pairing Requests</span>
                <button type="button" class="btn-secondary" id="btnChPairingRefresh" data-i18n="feishu.refreshPairing">
                  Refresh
                </button>
              </div>
              <div class="pairing-empty hidden" id="chPairingEmpty" data-i18n="feishu.noPairingPending">
                No pending pairing requests.
              </div>
              <div class="pairing-list hidden" id="chPairingList"></div>
            </div>

            <div class="pairing-panel">
              <div class="pairing-header">
                <span class="pairing-title" data-i18n="feishu.approvedTitle">Approved Accounts</span>
                <button type="button" class="btn-secondary" id="btnChApprovedRefresh" data-i18n="feishu.refreshApproved">
                  Refresh
                </button>
              </div>
              <div class="pairing-empty hidden" id="chApprovedEmpty" data-i18n="feishu.noApproved">
                No approved accounts yet.
              </div>
              <div class="pairing-list hidden" id="chApprovedList"></div>
            </div>
          </div>

          <!-- 错误 / 成功信息 -->
          <div class="msg-box hidden" id="chMsgBox"></div>

          <!-- 保存按钮 -->
          <div class="btn-row bottom-actions">
            <button class="btn-primary" id="btnChSave">
              <span class="btn-text" data-i18n="feishu.save">Save</span>
              <span class="btn-spinner hidden"></span>
            </button>
          </div>
        </div><!-- /channelFeishu -->
      </section>

      <!-- Kimi Tab -->
      <section class="tab-panel" id="tabKimi">
        <h2 data-i18n="kimi.title">KimiClaw</h2>

        <div class="channel-panel">
          <div class="channel-desc-row">
            <p class="desc" data-i18n="kimi.desc">Control OneClaw remotely via Kimi</p>
            <a href="#" class="platform-link" id="kimiBotPageLink" data-i18n="kimi.getGuide">Go to kimi.com/bot →</a>
          </div>

          <!-- 启用/禁用开关 -->
          <div class="toggle-row">
            <span class="toggle-label" data-i18n="kimi.enabled">Enable</span>
            <label class="toggle-switch">
              <input type="checkbox" id="kimiEnabled">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- 配置字段（禁用时隐藏） -->
          <div id="kimiFields" class="hidden">
            <p class="kimi-guide-text" data-i18n="kimi.guideText">Click 'Associate existing OpenClaw' → copy command → paste below</p>

            <div class="field-group">
              <label for="kimiSettingsInput" data-i18n="kimi.inputLabel">Paste BotToken or command (auto parse token)</label>
              <div class="input-password-wrap">
                <input type="password" id="kimiSettingsInput"
                  placeholder="bash &lt;(curl ...) --bot-token YOUR_TOKEN"
                  autocomplete="off" spellcheck="false">
                <button class="btn-toggle-vis" id="btnToggleKimiToken" type="button" title="Toggle visibility">
                  <svg class="icon-eye" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M1.5 9C1.5 9 4 3.75 9 3.75C14 3.75 16.5 9 16.5 9C16.5 9 14 14.25 9 14.25C4 14.25 1.5 9 1.5 9Z" stroke="currentColor" stroke-width="1.3"/>
                    <circle cx="9" cy="9" r="2.25" stroke="currentColor" stroke-width="1.3"/>
                  </svg>
                  <svg class="icon-eye-off hidden" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M2.5 2.5L15.5 15.5M7.05 7.05A2.25 2.25 0 0010.95 10.95M1.5 9C1.5 9 4 3.75 9 3.75C10.2 3.75 11.3 4.1 12.25 4.6M16.5 9C16.5 9 14 14.25 9 14.25C7.8 14.25 6.7 13.9 5.75 13.4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- 错误 / 成功信息 -->
          <div class="msg-box hidden" id="kimiMsgBox"></div>

          <!-- 保存按钮 -->
          <div class="btn-row bottom-actions">
            <button class="btn-primary" id="btnKimiSave">
              <span class="btn-text" data-i18n="kimi.save">Save</span>
              <span class="btn-spinner hidden"></span>
            </button>
          </div>
        </div>
      </section>

      <!-- Doctor Tab -->
      <section class="tab-panel" id="tabDoctor">
        <h2 data-i18n="doctor.title">Doctor</h2>
        <p class="desc" data-i18n="doctor.desc">Run diagnostics and auto-repair configuration issues.</p>

        <button class="btn-primary" id="btnDoctor">
          <span class="btn-text" data-i18n="doctor.run">Run Doctor</span>
          <span class="btn-spinner hidden"></span>
        </button>

        <pre class="doctor-log hidden" id="doctorLog"></pre>

        <div class="doctor-exit hidden" id="doctorExit"></div>
      </section>

      <!-- Advanced Tab -->
      <section class="tab-panel" id="tabAdvanced">
        <h2 data-i18n="advanced.title">Advanced</h2>
        <p class="desc" data-i18n="advanced.desc">Browser tool and messaging channel settings.</p>

        <!-- Browser Profile -->
        <div class="field-group">
          <label data-i18n="advanced.browserProfile">Browser Profile</label>
          <div class="radio-group">
            <label class="radio-item">
              <input type="radio" name="browserProfile" value="openclaw" checked>
              <span data-i18n="advanced.browserOpenclaw">Standalone browser instance</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="browserProfile" value="chrome">
              <span data-i18n="advanced.browserChrome">Chrome extension</span>
            </label>
          </div>
        </div>

        <!-- iMessage 频道 -->
        <div class="toggle-row">
          <span class="toggle-label" data-i18n="advanced.imessage">iMessage channel</span>
          <label class="toggle-switch">
            <input type="checkbox" id="imessageEnabled">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <!-- 消息框 -->
        <div class="msg-box hidden" id="advMsgBox"></div>

        <!-- 保存按钮 -->
        <div class="btn-row bottom-actions">
          <button class="btn-primary" id="btnAdvSave">
            <span class="btn-text" data-i18n="advanced.save">Save</span>
            <span class="btn-spinner hidden"></span>
          </button>
        </div>
      </section>

      <!-- Appearance Tab -->
      <section class="tab-panel" id="tabAppearance">
        <h2 data-i18n="appearance.title">外观</h2>
        <p class="desc" data-i18n="appearance.desc">调整主题和聊天展示相关设置。</p>

        <div class="field-group">
          <label data-i18n="appearance.theme">主题</label>
          <div class="radio-group">
            <label class="radio-item">
              <input type="radio" name="appearanceTheme" value="system" checked>
              <span data-i18n="appearance.theme.system">跟随系统</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="appearanceTheme" value="light">
              <span data-i18n="appearance.theme.light">浅色</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="appearanceTheme" value="dark">
              <span data-i18n="appearance.theme.dark">深色</span>
            </label>
          </div>
        </div>

        <div class="toggle-row">
          <span class="toggle-label" data-i18n="appearance.showThinking">显示思考过程</span>
          <label class="toggle-switch">
            <input type="checkbox" id="appearanceShowThinking">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="msg-box hidden" id="appearanceMsgBox"></div>

        <div class="btn-row bottom-actions">
          <button class="btn-primary" id="btnAppearanceSave">
            <span class="btn-text" data-i18n="appearance.save">保存</span>
            <span class="btn-spinner hidden"></span>
          </button>
        </div>
      </section>

    </main>
  </div>

  <script src="settings.js"></script>
</body>
</html>
